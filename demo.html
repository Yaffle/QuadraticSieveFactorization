<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Integer factorization calculator using Quadratic sieve algorithm</title>
<meta name="description" content="Web application that factors integers using MPQS algorithm.">

<script type="module">
  import isPrime from './isPrime.js';
  import factorize from './QuadraticSieveFactorization.js';
  document.querySelector('form').onsubmit = function (event) {
    event.preventDefault();
    document.querySelector('#indicator').hidden = false;
    window.setTimeout(function () {
      const start = Date.now();
      const integer = eval(document.querySelector('input').value.replace(/(\d+)/g, '$1n'));
      const primeFactors = [];
      if (integer < 0n) {
        primeFactors.push(-1n);
        integer = -integer;
      }
      const factors = [integer];
      while (factors.length !== 0) {
        let a = factors.pop();
        while (a !== 1n) {
          if (isPrime(a)) {
            primeFactors.push(BigInt(a));
            a /= a;
          } else {
            const f = BigInt(factorize(a));
            factors.push(f);
            if (a % f !== 0n) {
              throw new RangeError();
            }
            a /= f;
          }
        }
      }
      primeFactors.sort((a, b) => Number(a - b));
      const group = function (factors) {
        const result = [];
        let i = 0;
        for (let j = 0; j <= factors.length; j++) {
          if (j === factors.length || factors[i] !== factors[j]) {
            result.push({prime: factors[i], multiplicity: (j - i)});
            i = j;
          }
        }
        return result;
      };
      const end = Date.now();
      document.querySelector('#integer').innerHTML = integer;
      document.querySelector('#factors').innerHTML = group(primeFactors).map(g => g.multiplicity === 1 ? g.prime : g.prime + '**' + g.multiplicity).map(f => '<li>' + f + '</li>').join('\n');
      document.querySelector('#time').innerHTML = (end - start) + 'ms';
      document.querySelector('#indicator').hidden = true;
      document.querySelector('#result').hidden = false;
    }, 0);
  };
</script>
<style>
section > div {
  margin-top: 2em;
}
</style>
</head>
<body>
<h1>Integer factorization calculator using Quadratic sieve algorithm</h1>
<datalist id="samples">
  <option value="2**128 + 1" label="7th Fermat Number"></option>
  <option value="(10**71 - 1) / 9" label="The largest Cunnaningham Most Wanted number"></option>
  <option value="7293469445285646172092483905177589838606665884410340391954917800303813280275279" label="RSA-79"></option>
  <option value="1522605027922533360535618378132637429718068114961380688657908494580122963258952897654000350692006139" label="RSA-100"></option>
</datalist>
<div><form><label><div>Number to factorize:</div><input type="text" value="" list="samples" /></label><button>Go</button></form></div>
<progress id="indicator" hidden></progress>
<section id="result" hidden>
  <h2>Result:</h2>
  <div>
    Integer:
    <div><output id="integer">&nbsp;</output></div>
  </div>
  <div>
    Factors:
    <ul id="factors"></ul>
  </div>
  <div>
    Execution Time:
    <output id="time">&nbsp;</output>
  </div>
</section>
<div>
<p>
<a href="https://github.com/Yaffle/QuadraticSieveFactorization">source code</a>
</p>
<p>
Open the browser console to see the computation progress.
</p>
</div>
</body>
</html>
